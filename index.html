<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>

  <style>
    /*div {
      position:absolute;
      background-color:#abc;
      left:50px;
      width:90px;
      height:90px;
      margin:5px;
    }*/

    .mover {
      background-repeat: no-repeat;
      position: absolute;
      z-index: 5;
      background-image: url("src/img/edit-icon.png");
      /*background-color : blue;*/
      width: 48px;
      height: 48px;
      -moz-border-radius: 5px;
      -webkit-border-radius: 5px;
    }

  </style>

</head>
<body>

<div class="container">

  <canvas id="draws" width="600" height="600" style="border:1px solid #000000;"><br/>
    Your browser does not support HTML5 Canvas.<br/>
  </canvas>

  <div class="row">
    <input type="button" style="background-color:#000000;color:#ffffff;padding:3px;font-size:19px;"
           onClick="initAnimation()" value="Dibujar"/><br/><br/>

    <div>
      Por favor presione "Dibujar"
    </div>


    <br/>

    <div class="mover">
    </div>

  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-5">
      <textarea id="canvasCode"></textarea>
      <input type="button" value="Get points" onclick="manager.getPoints()">
    </div>
  </div>
</div>



<script src="src/js/jquery-2.1.4.js"></script>
<script src="src/js/mathManager.js"></script>
<script src="src/js/svgManager.js"></script>
<script src="src/js/manager.js"></script>

<script>

  var puntosRutaCompleta;
  var canvas;
  var context;
  var count = 0;
  var inter;
  var clr = 0;
  var rutasDibujadas = 0;
  var xyPoints;

  var points = {
    linePoint: []
  };

  var tiempoEspera = 0; //Tiempo estre la ainimacion de cada punto

  function Point(x, y) {
    this.x = x;
    this.y = y;
  }

  function initAnimation(){
    puntosRutaCompleta = manager.getPoints();
    entPoints();
  }

  function entPoints() {

    //var stringCanvasCode = document.querySelector('#canvasCode').value;

    if (rutasDibujadas >= puntosRutaCompleta.length) {
      //completarDibujo();
      return;
    }

    points.linePoint.length = 0;

    xyPoints = puntosRutaCompleta[rutasDibujadas];

    console.log('PUNTOS ACTUALES', puntosRutaCompleta);

    for (var i = 0; i < xyPoints.length; i++) {
      var x = xyPoints[i].x;
      var y = xyPoints[i].y;
      points.linePoint.push(new Point(x, y));
    }
    inter = setInterval("drawPoints()", tiempoEspera);
  }

  function drawPoints() {

//Caracteristicas
    canvas = document.getElementById('draws');
    ctx = canvas.getContext("2d");
    ctx.strokeStyle = "#C9BE62";
    ctx.lineWidth = 1;
    ctx.shadowColor = 'rgba(0,0,0,0.9)';
//Caracteristicas

    if (count == 0) {
      ctx.beginPath();
      ctx.moveTo(points.linePoint[count].x, points.linePoint[count].y);
    } else {
      ctx.moveTo(points.linePoint[count - 1].x, points.linePoint[count - 1].y);
      ctx.lineTo(points.linePoint[count].x, points.linePoint[count].y);
    }

    ctx.stroke();

    var posX = points.linePoint[count].x + getX(canvas);
    var posY = points.linePoint[count].y + getY(canvas) - 48; //El tamaÃ±o de la imagen del lapiz que escribe

    posX += "";
    posY += "";

    $(".mover").animate({
      "top": posY,
      "left": posX
    }, 0);

    count++;

    if (count == xyPoints.length) {
      rutasDibujadas++;
      count = 0; //Se reinicia el contador
      clearInterval(inter);
      entPoints();
    }

  }


  function getX(oElement) {
    var iReturnValue = 0;
    while (oElement != null) {
      iReturnValue += oElement.offsetLeft;
      oElement = oElement.offsetParent;
    }
    return iReturnValue;
  }

  function getY(oElement) {
    var iReturnValue = 0;
    while (oElement != null) {
      iReturnValue += oElement.offsetTop;
      oElement = oElement.offsetParent;
    }
    return iReturnValue;
  }

</script>

</body>
</html>
